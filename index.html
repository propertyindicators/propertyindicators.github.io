<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Сайт индикаторов рынка недвижимости</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.js"></script>
    <!-- Google Vizualization plugins -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <div class="container">
        <div class="row">
            <div class="col-lg-4"></div>
            <div class="col-lg-4"></div>
            <div class="col-lg-4"></div>
            <div class="col-lg-4"></div>
        </div>
    </div>

    <div class="container">
        <h1> Здравствуй, аналитик рынка недвижимости!</h1>
        <button type="button" id="butt1" class="btn btn-warning">с 2010 года</button>
        <button type="button" id="butt2" class="btn btn-warning">5 лет</button>
        <button type="button" id="butt3" class="btn btn-warning">3 года</button>
        <button type="button" id="butt4" class="btn btn-warning">2 года</button>
        <button type="button" id="butt5" class="btn btn-warning">1 год</button>
        <button type="button" id="butt6" class="btn btn-warning">полгода</button>
        <button type="button" id="butt7" class="btn btn-warning">квартал</button>
    </div>

    <div class="container" id="chart_div1" style="width: 1170px; height: 600px;"> </div>
    <div class="container" id="chart_div2" style="width: 1170px; height: 600px;"> </div>
    <div class="container" id="chart_div3" style="width: 1170px; height: 600px;"> </div>
    <div class="container" id="chart_div4" style="width: 1170px; height: 600px;"> </div>

    <script type="text/javascript">
        google.charts.load("visualization", "1", {packages:["corechart"]});
        
        var gdata1={};
        var goptions1={};
        var datemax={};
        var datemin={};
        var gchart1={};
    
        
        google.charts.setOnLoadCallback(initialize1);
        google.charts.setOnLoadCallback(initialize2);
        google.charts.setOnLoadCallback(initialize3);
        google.charts.setOnLoadCallback(initialize4);

        //массив соответствий отступов месяцев для каждой кнопки
        var miar=[0,60,36,24,12,6,3]

        var b1 = document.getElementById('butt1');
        var b2 = document.getElementById('butt2');
        var b3 = document.getElementById('butt3');
        var b4 = document.getElementById('butt4');
        var b5 = document.getElementById('butt5');
        var b6 = document.getElementById('butt6');
        var b7 = document.getElementById('butt7');

        b1.onclick = DrawWithPeriod;
        b2.onclick = DrawWithPeriod;
        b3.onclick = DrawWithPeriod;
        b4.onclick = DrawWithPeriod;
        b5.onclick = DrawWithPeriod;
        b6.onclick = DrawWithPeriod;
        b7.onclick = DrawWithPeriod;


        function DrawWithPeriod() {
            var callname = $(this).attr('id');
            var butnum = +callname.substring(4, 5);
            var tmind = {};
            if (butnum == 1) {tmind=new Date(datemin);}
            else { tmind = new Date(datemax); tmind.setMonth(-1 * miar[butnum - 1]) }
            goptions1.hAxis.viewWindow.min = tmind;
            gchart1.draw(gdata1, goptions1);
        }

        function initialize1() {
            //https://fusiontables.google.com/data?docid=1orRRsnXzp-wDVxcZKBo1B7BKULyVKo4qT9vLHHzU
            var tableid = '1orRRsnXzp-wDVxcZKBo1B7BKULyVKo4qT9vLHHzU';
            var uri = "SELECT RegDate, C_C, C_NC, C_EV, C_P FROM " + tableid;
            var queryText = "https://www.google.com/fusiontables/gvizdata?tq=" + encodeURIComponent(uri);
            var query = new google.visualization.Query(queryText);
            // Send the query with a callback function.
            query.send(handleQueryResponse1);
        }

        function handleQueryResponse1(response) {
            if (response.isError()) {
                alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }

            //передаем базовый набор элементов в глобальную видимость
            gdata1 = response.getDataTable();
            datemax=gdata1.getColumnRange(0).max;
            datemin=gdata1.getColumnRange(0).min;
            gdata1.pg[1].label = "Центр";
            gdata1.pg[2].label = "Близко к центру";
            gdata1.pg[3].label = "Середина";
            gdata1.pg[4].label = "Периферия";
            goptions1 = {
                title: 'Динамика цен аренды на нежилые помещения в г.Киеве',
                //hAxis: {title: 'Периоды (годы)',  titleTextStyle: {color: '#333'}},
                vAxis: { minValue: 0, format: '$#' },
                legend: { position: 'bottom' },
                series: {
                    0: { color: '#0000FF' },
                    1: { color: '#FF8C00' },
                    2: { color: '#FF0000' },
                    3: { color: '#006400' },
                },
                animation:{ duration: 1000, easing: 'linear', startup: true},
                hAxis: { viewWindow:{min: datemin, max: datemax} },
            };
            gchart1 = new google.visualization.AreaChart(document.getElementById('chart_div1'));
            gchart1.draw(gdata1, goptions1);
        }
  

        function initialize2() {
            //https://fusiontables.google.com/data?docid=1orRRsnXzp-wDVxcZKBo1B7BKULyVKo4qT9vLHHzU
            var tableid = '1orRRsnXzp-wDVxcZKBo1B7BKULyVKo4qT9vLHHzU';
            var uri = "SELECT RegDate, T_K, T_C, T_NC, T_EV, T_P, O_K, O_C, O_NC, O_EV, O_P FROM " + tableid + " WHERE RegDate>='2016-12-02' AND RegDate<='2017-01-06'";
            var queryText = "https://www.google.com/fusiontables/gvizdata?tq=" + encodeURIComponent(uri);
            var query = new google.visualization.Query(queryText);
            // Send the query with a callback function.
            query.send(handleQueryResponse2);
        }

        function handleQueryResponse2(response) {
            if (response.isError()) {
                alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }
            var data = response.getDataTable();
            drawChart2(data);
        }

        function drawChart2(predata) {

            var options = {
                title: 'Текущие ставки аренды на нежилые помещения в г.Киеве',
                //hAxis: {title: 'Территориальные зоны',  titleTextStyle: {color: '#333'}},
                vAxis: { minValue: 0, format: '$#' },
                legend: { position: 'bottom' },
                colors: ['#9932CC', '#808000'],
                animation:{ duration: 1000, easing: 'linear', startup: true},
            };

            var evarr = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            for (var i = 0; i < 10; i++) { predata.qg.forEach(function (item, j, arr) { evarr[i] = evarr[i] + item.c[i + 1].v }); evarr[i] = evarr[i] / predata.qg.length };
            var data = google.visualization.arrayToDataTable([
               ['Зона', 'Торговые', { role: 'style' }, 'Офисы', { role: 'style' }],
               ['Киев', evarr[0], '#8B0000', evarr[5], '#FF0000'],
               ['Центр', evarr[1], '#9932CC', evarr[6], '#808000'],
               ['Близко к центру', evarr[2], '#9932CC', evarr[7], '#808000'],
               ['Середина', evarr[3], '#9932CC', evarr[8], '#808000'],
               ['Периферия', evarr[4], '#9932CC', evarr[9], '#808000']]);
            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div2'));
            chart.draw(data, options);

        }

        function initialize3() {
            //https://fusiontables.google.com/data?docid=1orRRsnXzp-wDVxcZKBo1B7BKULyVKo4qT9vLHHzU
            var tableid = '1orRRsnXzp-wDVxcZKBo1B7BKULyVKo4qT9vLHHzU';
            var uri = "SELECT RegDate, OP_K, OP_C, OP_NC, OP_EV, OP_P, O_K, O_C, O_NC, O_EV, O_P FROM " + tableid + " WHERE RegDate>='2016-12-02' AND RegDate<='2017-01-06'";
            var queryText = "https://www.google.com/fusiontables/gvizdata?tq=" + encodeURIComponent(uri);
            var query = new google.visualization.Query(queryText);
            // Send the query with a callback function.
            query.send(handleQueryResponse3);
        }

        function handleQueryResponse3(response) {
            if (response.isError()) {
                alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }
            var data = response.getDataTable();
            drawChart3(data);
        }

        function drawChart3(predata) {

            var options = {
                title: 'Текущие ставки аренды офисов в г.Киеве',
                //hAxis: {title: 'Территориальные зоны',  titleTextStyle: {color: '#333'}},
                vAxis: { minValue: 0, format: '$#' },
                legend: { position: 'bottom' },
                colors: ['#006400', '#808000'],
                animation:{ duration: 1000, easing: 'linear', startup: true},
            };

            var evarr = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            for (var i = 0; i < 10; i++) { predata.qg.forEach(function (item, j, arr) { evarr[i] = evarr[i] + item.c[i + 1].v }); evarr[i] = evarr[i] / predata.qg.length };
            var data = google.visualization.arrayToDataTable([
               ['Зона', 'Профессиональные офисы', { role: 'style' }, 'Офисы', { role: 'style' }],
               ['Киев', evarr[0], '#8B0000', evarr[5], '#FF0000'],
               ['Центр', evarr[1], '#006400', evarr[6], '#808000'],
               ['Близко к центру', evarr[2], '#006400', evarr[7], '#808000'],
               ['Середина', evarr[3], '#006400', evarr[8], '#808000'],
               ['Периферия', evarr[4], '#006400', evarr[9], '#808000']]);
            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div3'));
            chart.draw(data, options);

        }

        function initialize4() {
            //https://fusiontables.google.com/data?docid=1orRRsnXzp-wDVxcZKBo1B7BKULyVKo4qT9vLHHzU
            var tableid = '1orRRsnXzp-wDVxcZKBo1B7BKULyVKo4qT9vLHHzU';
            var uri = "SELECT RegDate, TP_K, TP_C, TP_NC, TP_EV, TP_P, T_K, T_C, T_NC, T_EV, T_P FROM " + tableid + " WHERE RegDate>='2016-12-02' AND RegDate<='2017-01-06'";
            var queryText = "https://www.google.com/fusiontables/gvizdata?tq=" + encodeURIComponent(uri);
            var query = new google.visualization.Query(queryText);
            // Send the query with a callback function.
            query.send(handleQueryResponse4);
        }

        function handleQueryResponse4(response) {
            if (response.isError()) {
                alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }
            var data = response.getDataTable();
            drawChart4(data);
        }

        function drawChart4(predata) {

            var options = {
                title: 'Текущие ставки аренды торговых помещений в г.Киеве',
                //hAxis: {title: 'Территориальные зоны',  titleTextStyle: {color: '#333'}},
                vAxis: { minValue: 0, format: '$#' },
                legend: { position: 'bottom' },
                colors: ['#800080', '#9932CC'],
                animation:{ duration: 1000, easing: 'linear', startup: true},
            };

            var evarr = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            for (var i = 0; i < 10; i++) { predata.qg.forEach(function (item, j, arr) { evarr[i] = evarr[i] + item.c[i + 1].v }); evarr[i] = evarr[i] / predata.qg.length };
            var data = google.visualization.arrayToDataTable([
               ['Зона', 'Профессиональные торговые', { role: 'style' }, 'Торговые', { role: 'style' }],
               ['Киев', evarr[0], '#8B0000', evarr[5], '#FF0000'],
               ['Центр', evarr[1], '#800080	', evarr[6], '#9932CC'],
               ['Близко к центру', evarr[2], '#800080', evarr[7], '#9932CC'],
               ['Середина', evarr[3], '#800080', evarr[8], '#9932CC'],
               ['Периферия', evarr[4], '#800080', evarr[9], '#9932CC']]);
            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div4'));
            chart.draw(data, options);

        }


    </script>

</body>
</html>
