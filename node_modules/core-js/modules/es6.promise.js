/*! PILab 02-02-2022 */

"use strict";var LIBRARY=require("./_library"),global=require("./_global"),ctx=require("./_ctx"),classof=require("./_classof"),$export=require("./_export"),isObject=require("./_is-object"),aFunction=require("./_a-function"),anInstance=require("./_an-instance"),forOf=require("./_for-of"),speciesConstructor=require("./_species-constructor"),task=require("./_task").set,microtask=require("./_microtask")(),newPromiseCapabilityModule=require("./_new-promise-capability"),perform=require("./_perform"),userAgent=require("./_user-agent"),promiseResolve=require("./_promise-resolve"),PROMISE="Promise",TypeError=global.TypeError,process=global.process,versions=process&&process.versions,v8=versions&&versions.v8||"",$Promise=global[PROMISE],isNode="process"==classof(process),empty=function(){},Internal,newGenericPromiseCapability,OwnPromiseCapability,Wrapper,newPromiseCapability=newGenericPromiseCapability=newPromiseCapabilityModule.f,USE_NATIVE=!!function(){try{var a=$Promise.resolve(1),b=(a.constructor={})[require("./_wks")("species")]=function(a){a(empty,empty)};return(isNode||"function"==typeof PromiseRejectionEvent)&&a.then(empty)instanceof b&&0!==v8.indexOf("6.6")&&-1===userAgent.indexOf("Chrome/66")}catch(a){}}(),isThenable=function(a){var b;return!(!isObject(a)||"function"!=typeof(b=a.then))&&b},notify=function(a,b){if(!a._n){a._n=!0;var c=a._c;microtask(function(){for(var d=a._v,e=1==a._s,f=0;c.length>f;)!function(b){var c,f,g,h=e?b.ok:b.fail,i=b.resolve,j=b.reject,k=b.domain;try{h?(e||(2==a._h&&onHandleUnhandled(a),a._h=1),!0===h?c=d:(k&&k.enter(),c=h(d),k&&(k.exit(),g=!0)),c===b.promise?j(TypeError("Promise-chain cycle")):(f=isThenable(c))?f.call(c,i,j):i(c)):j(d)}catch(a){k&&!g&&k.exit(),j(a)}}(c[f++]);a._c=[],a._n=!1,b&&!a._h&&onUnhandled(a)})}},onUnhandled=function(a){task.call(global,function(){var b,c,d,e=a._v,f=isUnhandled(a);if(f&&(b=perform(function(){isNode?process.emit("unhandledRejection",e,a):(c=global.onunhandledrejection)?c({promise:a,reason:e}):(d=global.console)&&d.error&&d.error("Unhandled promise rejection",e)}),a._h=isNode||isUnhandled(a)?2:1),a._a=void 0,f&&b.e)throw b.v})},isUnhandled=function(a){return 1!==a._h&&0===(a._a||a._c).length},onHandleUnhandled=function(a){task.call(global,function(){var b;isNode?process.emit("rejectionHandled",a):(b=global.onrejectionhandled)&&b({promise:a,reason:a._v})})},$reject=function(a){var b=this;b._d||(b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),notify(b,!0))},$resolve=function(a){var b,c=this;if(!c._d){c._d=!0,c=c._w||c;try{if(c===a)throw TypeError("Promise can't be resolved itself");(b=isThenable(a))?microtask(function(){var d={_w:c,_d:!1};try{b.call(a,ctx($resolve,d,1),ctx($reject,d,1))}catch(a){$reject.call(d,a)}}):(c._v=a,c._s=1,notify(c,!1))}catch(a){$reject.call({_w:c,_d:!1},a)}}};USE_NATIVE||($Promise=function(a){anInstance(this,$Promise,PROMISE,"_h"),aFunction(a),Internal.call(this);try{a(ctx($resolve,this,1),ctx($reject,this,1))}catch(a){$reject.call(this,a)}},Internal=function(a){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},Internal.prototype=require("./_redefine-all")($Promise.prototype,{then:function(a,b){var c=newPromiseCapability(speciesConstructor(this,$Promise));return c.ok="function"!=typeof a||a,c.fail="function"==typeof b&&b,c.domain=isNode?process.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&notify(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),OwnPromiseCapability=function(){var a=new Internal;this.promise=a,this.resolve=ctx($resolve,a,1),this.reject=ctx($reject,a,1)},newPromiseCapabilityModule.f=newPromiseCapability=function(a){return a===$Promise||a===Wrapper?new OwnPromiseCapability(a):newGenericPromiseCapability(a)}),$export($export.G+$export.W+$export.F*!USE_NATIVE,{Promise:$Promise}),require("./_set-to-string-tag")($Promise,PROMISE),require("./_set-species")(PROMISE),Wrapper=require("./_core")[PROMISE],$export($export.S+$export.F*!USE_NATIVE,PROMISE,{reject:function(a){var b=newPromiseCapability(this);return(0,b.reject)(a),b.promise}}),$export($export.S+$export.F*(LIBRARY||!USE_NATIVE),PROMISE,{resolve:function(a){return promiseResolve(LIBRARY&&this===Wrapper?$Promise:this,a)}}),$export($export.S+$export.F*!(USE_NATIVE&&require("./_iter-detect")(function(a){$Promise.all(a).catch(empty)})),PROMISE,{all:function(a){var b=this,c=newPromiseCapability(b),d=c.resolve,e=c.reject,f=perform(function(){var c=[],f=0,g=1;forOf(a,!1,function(a){var h=f++,i=!1;c.push(void 0),g++,b.resolve(a).then(function(a){i||(i=!0,c[h]=a,--g||d(c))},e)}),--g||d(c)});return f.e&&e(f.v),c.promise},race:function(a){var b=this,c=newPromiseCapability(b),d=c.reject,e=perform(function(){forOf(a,!1,function(a){b.resolve(a).then(c.resolve,d)})});return e.e&&d(e.v),c.promise}});