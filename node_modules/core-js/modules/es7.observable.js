/*! PILab 18-07-2021 */

"use strict";var $export=require("./_export"),global=require("./_global"),core=require("./_core"),microtask=require("./_microtask")(),OBSERVABLE=require("./_wks")("observable"),aFunction=require("./_a-function"),anObject=require("./_an-object"),anInstance=require("./_an-instance"),redefineAll=require("./_redefine-all"),hide=require("./_hide"),forOf=require("./_for-of"),RETURN=forOf.RETURN,getMethod=function(a){return null==a?void 0:aFunction(a)},cleanupSubscription=function(a){var b=a._c;b&&(a._c=void 0,b())},subscriptionClosed=function(a){return void 0===a._o},closeSubscription=function(a){subscriptionClosed(a)||(a._o=void 0,cleanupSubscription(a))},Subscription=function(a,b){anObject(a),this._c=void 0,this._o=a,a=new SubscriptionObserver(this);try{var c=b(a),d=c;null!=c&&("function"==typeof c.unsubscribe?c=function(){d.unsubscribe()}:aFunction(c),this._c=c)}catch(b){return void a.error(b)}subscriptionClosed(this)&&cleanupSubscription(this)};Subscription.prototype=redefineAll({},{unsubscribe:function(){closeSubscription(this)}});var SubscriptionObserver=function(a){this._s=a};SubscriptionObserver.prototype=redefineAll({},{next:function(a){var b=this._s;if(!subscriptionClosed(b)){var c=b._o;try{var d=getMethod(c.next);if(d)return d.call(c,a)}catch(a){try{closeSubscription(b)}finally{throw a}}}},error:function(a){var b=this._s;if(subscriptionClosed(b))throw a;var c=b._o;b._o=void 0;try{var d=getMethod(c.error);if(!d)throw a;a=d.call(c,a)}catch(a){try{cleanupSubscription(b)}finally{throw a}}return cleanupSubscription(b),a},complete:function(a){var b=this._s;if(!subscriptionClosed(b)){var c=b._o;b._o=void 0;try{var d=getMethod(c.complete);a=d?d.call(c,a):void 0}catch(a){try{cleanupSubscription(b)}finally{throw a}}return cleanupSubscription(b),a}}});var $Observable=function(a){anInstance(this,$Observable,"Observable","_f")._f=aFunction(a)};redefineAll($Observable.prototype,{subscribe:function(a){return new Subscription(a,this._f)},forEach:function(a){var b=this;return new(core.Promise||global.Promise)(function(c,d){aFunction(a);var e=b.subscribe({next:function(b){try{return a(b)}catch(a){d(a),e.unsubscribe()}},error:d,complete:c})})}}),redefineAll($Observable,{from:function(a){var b="function"==typeof this?this:$Observable,c=getMethod(anObject(a)[OBSERVABLE]);if(c){var d=anObject(c.call(a));return d.constructor===b?d:new b(function(a){return d.subscribe(a)})}return new b(function(b){var c=!1;return microtask(function(){if(!c){try{if(forOf(a,!1,function(a){if(b.next(a),c)return RETURN})===RETURN)return}catch(a){if(c)throw a;return void b.error(a)}b.complete()}}),function(){c=!0}})},of:function(){for(var a=0,b=arguments.length,c=new Array(b);a<b;)c[a]=arguments[a++];return new("function"==typeof this?this:$Observable)(function(a){var b=!1;return microtask(function(){if(!b){for(var d=0;d<c.length;++d)if(a.next(c[d]),b)return;a.complete()}}),function(){b=!0}})}}),hide($Observable.prototype,OBSERVABLE,function(){return this}),$export($export.G,{Observable:$Observable}),require("./_set-species")("Observable");