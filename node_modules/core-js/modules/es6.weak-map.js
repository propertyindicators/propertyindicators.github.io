/*! PILab 23-01-2021 (c) 2017 propertyindicators@gmail.com */

"use strict";var each=require("./_array-methods")(0),redefine=require("./_redefine"),meta=require("./_meta"),assign=require("./_object-assign"),weak=require("./_collection-weak"),isObject=require("./_is-object"),fails=require("./_fails"),validate=require("./_validate-collection"),WEAK_MAP="WeakMap",getWeak=meta.getWeak,isExtensible=Object.isExtensible,uncaughtFrozenStore=weak.ufstore,tmp={},InternalMap,wrapper=function(a){return function(){return a(this,arguments.length>0?arguments[0]:void 0)}},methods={get:function(a){if(isObject(a)){var b=getWeak(a);return!0===b?uncaughtFrozenStore(validate(this,WEAK_MAP)).get(a):b?b[this._i]:void 0}},set:function(a,b){return weak.def(validate(this,WEAK_MAP),a,b)}},$WeakMap=module.exports=require("./_collection")(WEAK_MAP,wrapper,methods,weak,!0,!0);fails(function(){return 7!=(new $WeakMap).set((Object.freeze||Object)(tmp),7).get(tmp)})&&(InternalMap=weak.getConstructor(wrapper,WEAK_MAP),assign(InternalMap.prototype,methods),meta.NEED=!0,each(["delete","has","get","set"],function(a){var b=$WeakMap.prototype,c=b[a];redefine(b,a,function(b,d){if(isObject(b)&&!isExtensible(b)){this._f||(this._f=new InternalMap);var e=this._f[a](b,d);return"set"==a?this:e}return c.call(this,b,d)})}));