/*! PILab 18-07-2021 */

var ctx=require("./_ctx"),invoke=require("./_invoke"),html=require("./_html"),cel=require("./_dom-create"),global=require("./_global"),process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,Dispatch=global.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port,run=function(){var a=+this;if(queue.hasOwnProperty(a)){var b=queue[a];delete queue[a],b()}},listener=function(a){run.call(a.data)};setTask&&clearTask||(setTask=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return queue[++counter]=function(){invoke("function"==typeof a?a:Function(a),b)},defer(counter),counter},clearTask=function(a){delete queue[a]},"process"==require("./_cof")(process)?defer=function(a){process.nextTick(ctx(run,a,1))}:Dispatch&&Dispatch.now?defer=function(a){Dispatch.now(ctx(run,a,1))}:MessageChannel?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener,defer=ctx(port.postMessage,port,1)):global.addEventListener&&"function"==typeof postMessage&&!global.importScripts?(defer=function(a){global.postMessage(a+"","*")},global.addEventListener("message",listener,!1)):defer=ONREADYSTATECHANGE in cel("script")?function(a){html.appendChild(cel("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run.call(a)}}:function(a){setTimeout(ctx(run,a,1),0)}),module.exports={set:setTask,clear:clearTask};