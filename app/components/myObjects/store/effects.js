/*! PILab 02-02-2022 */

"use strict";var __decorate=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),effects_1=require("@ngrx/effects"),operators_1=require("rxjs/operators"),of_1=require("rxjs/observable/of"),actions_1=require("./actions"),store_1=require("@ngrx/store"),from_1=require("rxjs/observable/from"),service_param_dict_1=require("../service.param-dict"),rxjs_1=require("rxjs"),AppEffects=function(){function a(a,b,c){var d=this;this.actions$=a,this.store$=b,this.paramDictDownloader=c,this.deleteObjectOnServer$=this.actions$.pipe(effects_1.ofType(actions_1.EObjectListActions.DeleteObject),operators_1.withLatestFrom(this.store$.select(function(a){return a.ObjectListState.DocExtractor})),operators_1.mergeMap(function(a){var b=a[0],c=a[1];return from_1.from(c.DeletePremises(b.payload)).pipe(operators_1.map(function(a){return{type:actions_1.EObjectListActions.ObjectDeleted,payload:a}}),operators_1.catchError(function(a){return of_1.of({type:actions_1.EObjectListActions.ServerError,payload:"Object deletion: "+a})}))})),this.initDatadGoogleChartsAndCn$=this.actions$.pipe(effects_1.ofType(actions_1.EObjectListActions.InitData),operators_1.map(function(){return google.charts.load("current",{packages:["corechart","bar"]}),google.charts.setOnLoadCallback(function(){return d.store$.dispatch(new actions_1.GoogleChartsLoaded)}),Cn?new actions_1.CnLoaded(Cn):(PageAuthActions=function(a){d.store$.dispatch(new actions_1.CnLoaded(a))},new actions_1.DoNothing("From initDatadGoogleChartsAndCn"))})),this.initDatadCnDocument$=this.actions$.pipe(effects_1.ofType(actions_1.EObjectListActions.CnLoaded),operators_1.map(function(a){return a.payload.Get(function(a){d.store$.dispatch(new actions_1.CnDocLoaded(a))},function(a){d.store$.dispatch(new actions_1.ServerError(a))}),new actions_1.DoNothing("From initDatadCnDocument")})),this.initDataParamDict$=this.actions$.pipe(effects_1.ofType(actions_1.EObjectListActions.InitData),operators_1.mergeMap(function(){return d.paramDictDownloader.Download().pipe(operators_1.map(function(a){return{type:actions_1.EObjectListActions.ParamDictLoaded,payload:a}}),operators_1.catchError(function(a){return of_1.of({type:actions_1.EObjectListActions.ServerError,payload:"ParamDict loading: "+a})}))})),this.initDataIsDataReady$=this.actions$.pipe(effects_1.ofType(actions_1.EObjectListActions.GoogleChartsLoaded,actions_1.EObjectListActions.CnDocLoaded,actions_1.EObjectListActions.ParamDictLoaded),operators_1.withLatestFrom(this.store$.select(function(a){return a.ObjectListState})),operators_1.map(function(a){var b=a[0],c=a[1];return c.GoogleChartsLoaded&&c.DocExtractor.cnDoc&&c.DocExtractor.paramDict?new actions_1.SetDataReady:new actions_1.DoNothing(b)}))}return __decorate([effects_1.Effect(),__metadata("design:type",rxjs_1.Observable)],a.prototype,"deleteObjectOnServer$",void 0),__decorate([effects_1.Effect(),__metadata("design:type",rxjs_1.Observable)],a.prototype,"initDatadGoogleChartsAndCn$",void 0),__decorate([effects_1.Effect(),__metadata("design:type",rxjs_1.Observable)],a.prototype,"initDatadCnDocument$",void 0),__decorate([effects_1.Effect(),__metadata("design:type",rxjs_1.Observable)],a.prototype,"initDataParamDict$",void 0),__decorate([effects_1.Effect(),__metadata("design:type",rxjs_1.Observable)],a.prototype,"initDataIsDataReady$",void 0),a=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[effects_1.Actions,store_1.Store,service_param_dict_1.ParamDictDownloader])],a)}();exports.AppEffects=AppEffects;