/*! PILab 02-02-2022 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var state_1=require("./store/state"),rxjs_1=require("rxjs"),PremisesParamsUiModel=function(){function a(){this.square="",this.placement="",this.buildtype_mb="",this.buildtype_otb="",this.entry_type="",this.entry_placement="",this.add_trade_features=new Array,this.remclass="",this.devaluation="",this.avail="",this.addelements=new Array}return a}();exports.PremisesParamsUiModel=PremisesParamsUiModel;var DocExtractor=function(){function a(){}return a.prototype.ExtractPremisesParams=function(a){return a<0?null:this.ExtractPremisesParamsObj(this.cnDoc.Premises[a].P)},a.prototype.GetPremisesCount=function(){return this.cnDoc.Premises?this.cnDoc.Premises.length:0},a.prototype.ExtractPremisesParamsObj=function(a){var b=new PremisesParamsUiModel;b.district=this.paramDict.districts[a.Addr[0]],b.massif=this.paramDict.massifs[a.Addr[1]],b.street=a.Addr[2],b.numberOnStreet=a.Addr[3],b.square=a.Coefs[0].toString()+" кв.м",b.placement=this.paramDict.placement_dict[a.Params[0]][0],b.buildtype_mb=this.paramDict.buildtype_mb_dict[a.Params[1]][0],b.buildtype_otb=this.paramDict.buildtype_otb_dict[a.Params[2]][0],b.entry_type=this.paramDict.entry_type_dict[a.Params[3]],b.entry_placement=this.paramDict.entry_placement_dict[a.Params[4]];for(var c in a.Params[5])b.add_trade_features.push(this.paramDict.tradevalue_features[a.Params[5][c]][0]);b.fund=1===a.Coefs[5]?"Жилой":"Нежилой",b.remclass=this.paramDict.remclass_dict[a.Params[6]][0],b.devaluation=this.paramDict.devaluation_dict[a.Params[7]][0],b.avail=this.paramDict.avail_dict[a.Params[8]][0];for(var c in a.Params[9])b.addelements.push(this.paramDict.addelements_dict[a.Params[9][c]][0]);return b.needDeval=a.Params[6]>3,b.needAvail=b.needDeval&&1===a.Params[7],b.needAddElem=b.needDeval&&a.Params[7]>1,b},a.prototype.ExtractPremisesSquare=function(a){return a<0?-1:this.cnDoc.Premises[a].P.Coefs[0]},a.prototype.DeletePremises=function(a){var b=this,c=Object.assign({},this.cnDoc);return c.Premises.splice(a,1),rxjs_1.Observable.create(function(a){return b.cn.Put(c,function(c){b.cnDoc=c,a.next(c)})})},a.prototype.ExtractPremisesEvaluationObj=function(a){if(a<0)return null;for(var b=this.cnDoc.Premises[a].E,c=0,d=b;c<d.length;c++){var e=d[c];e.On=new Date(e.On)}return b},a.prototype.CreateObjectList=function(){for(var a=new Array,b=this.GetPremisesCount(),c=0;c<b;c++){var d=this.ExtractPremisesParams(c),e=d.street;e=""===d.numberOnStreet?e:e+" "+d.numberOnStreet,e+=" ("+d.massif+")";var f=e+", "+d.square+", "+d.placement;a.push(new state_1.ObjRow(c,f))}return a},a}();exports.DocExtractor=DocExtractor;