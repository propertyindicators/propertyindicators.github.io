/*! PILab 02-02-2022 */

"use strict";var __decorate=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),store_1=require("@ngrx/store"),HistoryComponent=function(){function a(a,b){this.store=a,this.ngZone=b,this.objUISet$=this.store.select(function(a){return a.ObjectListState.HistoryViewData}),this.selectedPriceType="PerSqm",this.selectedCurrencyChart="Usd",this.selectedResultIndex=0,this.selectedCurrencyResult="usd",this.currSignDict={Usd:"$",Eur:"€",Uah:"₴"}}return a.prototype.ngOnInit=function(){var a=this,b=this.ngZone.onStable.subscribe(function(){a.chart=new google.visualization.LineChart(document.getElementById("chart")),google.visualization.events.addListener(a.chart,"select",function(){a.ngZone.run(function(){a.onChartPointSelected()})}),a.reDrawChart(),b.unsubscribe()});this.initChartOptions(),this.onObjectChanged=this.objUISet$.subscribe(function(b){return a.updateViewData(b)})},a.prototype.ngOnDestroy=function(){this.onObjectChanged.unsubscribe()},a.prototype.updateViewData=function(a){this.objUISet=a,a&&(this.selectedResultIndex=a.FullResults.length-1,this.chart&&this.reDrawChart())},a.prototype.changePriceType=function(a){this.selectedPriceType!=a&&(this.selectedPriceType=a,this.reDrawChart())},a.prototype.changeCurrChart=function(a){this.selectedCurrencyChart!=a&&(this.selectedCurrencyChart=a,this.reDrawChart())},a.prototype.changeCurrRes=function(a){this.selectedCurrencyResult!=a&&(this.selectedCurrencyResult=a)},a.prototype.onChartPointSelected=function(){var a=this.chart.getSelection();0!==a.length&&(this.selectedResultIndex=a[0].row)},a.prototype.initChartOptions=function(){this.chartOptions={legend:{position:"bottom"},series:{0:{targetAxisIndex:0,color:"#0000FF"},1:{targetAxisIndex:1,color:"#8B0000"}},animation:{duration:1e3,easing:"linear",startup:!0},hAxis:{viewWindow:{min:null,max:null}},chartArea:{left:"10%",width:"82%"},vAxes:{0:{viewWindow:{min:0,max:0},format:"$#",textStyle:{color:"#0000FF"}},1:{viewWindow:{min:0,max:0},format:"$#",textStyle:{color:"#8B0000"}}}}},a.prototype.recalcChartOptions=function(){var a=this.chartData.getNumberOfRows()-1,b=new Date(this.chartData.getValue(0,0).getTime()),c=new Date(this.chartData.getValue(a,0).getTime()),d=Math.round((c.getTime()-b.getTime())/864e5/26);b.setDate(b.getDate()-d),c.setDate(c.getDate()+d),this.chartOptions.hAxis.viewWindow.min=b,this.chartOptions.hAxis.viewWindow.max=c;var e=this.analizeChartDataDisp(),f=e.minSale+(e.maxSale-e.minSale)/2,g=e.minRent+(e.maxRent-e.minRent)/2,h=e.maxSale/f,i=e.maxRent/g,j=Math.max(h,i);this.chartOptions.vAxes[0].viewWindow.min=f/j*.96,this.chartOptions.vAxes[0].viewWindow.max=f*j*1.04,this.chartOptions.vAxes[1].viewWindow.min=g/j*.96,this.chartOptions.vAxes[1].viewWindow.max=g*j*1.04,this.chartOptions.vAxes[0].format=this.currSignDict[this.selectedCurrencyChart],this.chartOptions.vAxes[1].format=this.currSignDict[this.selectedCurrencyChart]},a.prototype.analizeChartDataDisp=function(){for(var a=JSON.parse(this.chartData.toJSON()),b=new ModelDispAnalysis,c=0,d=a.rows;c<d.length;c++){var e=d[c];e.c[1].v<b.minSale&&(b.minSale=e.c[1].v),e.c[1].v>b.maxSale&&(b.maxSale=e.c[1].v),e.c[2].v<b.minRent&&(b.minRent=e.c[2].v),e.c[2].v>b.maxRent&&(b.maxRent=e.c[2].v)}return b},a.prototype.reDrawChart=function(){this.chartData=this.objUISet[this.selectedPriceType][this.selectedCurrencyChart],this.recalcChartOptions(),this.chart.draw(this.chartData,this.chartOptions)},a=__decorate([core_1.Component({selector:"comp-history",moduleId:module.id,templateUrl:"component.history.html",styleUrls:["module.styles.css"]}),__metadata("design:paramtypes",[store_1.Store,core_1.NgZone])],a)}();exports.HistoryComponent=HistoryComponent;var ModelDispAnalysis=function(){function a(){this.minSale=1e9,this.maxSale=0,this.minRent=1e9,this.maxRent=0}return a}();