/*! PILab 18-04-2021 */

"use strict";var __decorate=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),http_1=require("@angular/common/http"),model_result_1=require("./model.result"),EvalPool=function(){function a(){this.Sqm=0,this.Flat=0}return a}(),CalcTabsPool=function(){function a(){this.usd=new Array,this.eur=new Array,this.hrn=new Array}return a}(),CalcService=function(){function a(a){this.http=a,this.isinit=!1,this.tabmin=new CalcTabsPool,this.tabmax=new CalcTabsPool,this.tabmain=new CalcTabsPool,this.valsnumeric=["min","max","main"],this.cursnumeric=["usd","eur","hrn"],this.curssymb={usd:"$",eur:"€",hrn:"₴"}}return a.prototype.getResultPromise=function(a,b){var c=this;return this.isinit?new Promise(function(d,e){var f=new model_result_1.ResultViewModel;for(var g in c.valsnumeric)for(var h in c.cursnumeric){var i=c.appriseVal(a,b,c.cursnumeric[h],c.valsnumeric[g]);f[c.cursnumeric[h]]["sqm_"+c.valsnumeric[g]]=c.spacingAndCurr(String(i.Sqm),c.cursnumeric[h]),f[c.cursnumeric[h]]["flat_"+c.valsnumeric[g]]=c.spacingAndCurr(String(i.Flat),c.cursnumeric[h])}d(f)}):new Promise(function(d,e){return c.InitData().then(function(){return c.getResultPromise(a,b).then(function(a){return d(a)}).catch(function(a){return e(a)})}).catch(function(a){return e(a)})})},a.prototype.InitData=function(){var a=this,b=this.http.get("./data/test/rescalcmin.json"),c=this.http.get("./data/test/rescalcmax.json"),d=this.http.get("./data/test/rescalcmain.json"),e=this.http.get("./data/test/exchange.json");return new Promise(function(f,g){return e.subscribe(function(e){a.CommonCalcParameters=e;var h=a.tabloader(b,a.tabmin),i=a.tabloader(c,a.tabmax),j=a.tabloader(d,a.tabmain);Promise.all([h,i,j]).then(function(){a.isinit=!0,f()}).catch(function(a){return g(a)})},function(a){return g(a)})})},a.prototype.appriseVal=function(a,b,c,d){var e=this["tab"+d][c],f=b.getTypeIndex(),g=e[f][a-1];return"first"===b.floor&&(g*=.9),"last"===b.floor&&(g*=.94),"pent"===b.floor&&(g*=1.1),g=g*(1e4/(.719*b.square+2.2876)+950)/(1e4/(.719*b.getRoomTypeAverage()+2.2876)+950),g+=(b.state-4)*this.CommonCalcParameters.cenabala,{Sqm:Math.round(g),Flat:Math.round(g*b.square)}},a.prototype.tabloader=function(a,b){var c=this;return new Promise(function(d,e){var f=c.CommonCalcParameters.usd,g=c.CommonCalcParameters.usd/c.CommonCalcParameters.eur;a.subscribe(function(a){for(var c=0;c<a.rows.length;c++){for(var e=new Array,h=new Array,i=new Array,j=0;j<64;j++){var k=Number(a.rows[c][j+2]);e.push(k),h.push(k*g),i.push(k*f)}b.usd.push(e),b.eur.push(h),b.hrn.push(i)}d()},function(a){e(a)})})},a.prototype.spacingAndCurr=function(a,b){for(var c=a.length,d="",e=1;e<=c;e++)d=e%3==0&&e!=c?" "+a.charAt(c-e)+d:a.charAt(c-e)+d;return d=this.curssymb[b]+" "+d},a=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.HttpClient])],a)}();exports.CalcService=CalcService;