/*! PILab 18-04-2021 */

"use strict";var __decorate=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),http_1=require("@angular/common/http"),StreetLine=function(){function a(a){a.length<12&&alert("Подгруженный поисковый пул улиц не соответствует по формату проектной структуре"),this.id=a[0],this.mas=a[1],this.distr=a[2],this.street_rus=a[3],this.street_ukr=a[4],this.multidistr=a[5],this.number_from=a[6],this.number_till=a[7],this.parity=a[8],this.peopleStreamValue=a[10],this.transportStreamValue=a[11],this.destinationCenter=a[12]}return a}();exports.StreetLine=StreetLine;var SearchWorker=function(){function a(a){this.http=a,this.data=[],this.distrdict={1:"goloseev",2:"darnic",3:"desnyan",4:"dneprov",5:"obolons",6:"pechers",7:"podols",8:"svyatosh",9:"solomens",10:"shevchen"}}return a.prototype.getData=function(){return this.data},a.prototype.setDataWhenDownloaded=function(a){this.data=a},a.prototype.initData=function(a){var b=this,c=this.http.get("./data/test/streets/com_"+this.distrdict[a]+".json");return new Promise(function(a,d){return c.subscribe(function(c){for(var d=[],e=0,f=c.rows;e<f.length;e++){var g=f[e];d.push(new StreetLine(g))}b.setDataWhenDownloaded(d),a()},function(a){d(a)})})},a.prototype.checkStreet=function(a){if(null===this.data)return this.checkMassive(a),void a.setIformColors();if(null===a.street||""===a.street)return a.street_is=!1,a.multimas=!1,a.street_found="Введите улицу!",this.checkMassive(a),void a.setIformColors();for(var b=new RegExp("^"+a.street,"i"),c=null,d="",e=0,f=this.data;e<f.length;e++){var g=f[e];if(null!=g.street_rus.match(b)){c=g,d="street_rus";break}if(null!=g.street_ukr.match(b)){c=g,d="street_ukr";break}}null===c?(a.street_is=!1,a.street_found='Улица "'+a.street+'" не обнаружена в пределах района "'+a.district+'"!',a.multimas=null):(a.street_is=!0,a.street_found=g[d],a.multimas=g.multidistr),this.checkMassive(a),a.setIformColors()},a.prototype.checkNumber=function(a){return null===a.number_str.match(/\d+/)?(a.number_is=!1,a.number_int=0,this.checkMassive(a),void a.setIformColors()):(a.number_int=parseInt(a.number_str,10),a.number_int<1||a.number_int>300?(a.massive_str="Номер дома введён не корректно!",a.number_is=!1,a.massive_is=!1,a.number_int=0,void a.setIformColors()):(a.number_is=!0,this.checkMassive(a),void a.setIformColors()))},a.prototype.checkMassive=function(a){null===this.data&&(a.street_found="NoSearchData",a.massive_str="NoSearchData",a.massive_is=!1),a.street_is?a.multimas?a.number_is?(this.assignLocationData(a),a.massive_str=0===a.massive_int?"Номер дома указан за пределами допустимого диапазона!":a.massivedict[a.massive_int],a.massive_is=0!==a.massive_int):(a.massive_str="Указанная улица пролегает через несколько массивов! Укажите номер дома, пожалуйста!",a.massive_is=!1):(this.assignLocationData(a),a.massive_str=a.massivedict[a.massive_int],a.massive_is=0!==a.massive_int):(""!==a.street?a.massive_str="Укажите корректно улицу, пожалуйста!":a.massive_str="",a.massive_is=!1)},a.prototype.assignLocationData=function(a){if(a.massive_int=0,a.peopleStreamValue=0,a.transportStreamValue=0,a.destinationCenter=0,!(null===this.data||null===a.street_found||""===a.street_found||a.multimas&&0===a.number_int)){for(var b=a.number_int%2,c=new RegExp("^"+a.street_found,"i"),d=null,e=0,f=this.data;e<f.length;e++){var g=f[e],h=g.street_rus.match(c),i=g.street_ukr.match(c);if(null!=h||null!=i){if(!a.multimas){d=g;break}var j=!0;if(""!==g.parity&&(j=j&&(0===b&&"ч"===g.parity||0!==b&&"н"===g.parity)),-1!==g.number_from&&(j=j&&a.number_int>=g.number_from),-1!==g.number_till&&(j=j&&a.number_int<=g.number_till),j){d=g;break}}}return null===d?void 0:(a.massive_int=g.mas,a.peopleStreamValue=g.peopleStreamValue,a.transportStreamValue=g.transportStreamValue,void(a.destinationCenter=g.destinationCenter))}},a=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.HttpClient])],a)}();exports.SearchWorker=SearchWorker;